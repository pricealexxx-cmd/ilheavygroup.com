<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Download App</title>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NFZ363R577"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NFZ363R577');
</script>

<!-- counter.dev -->
<script
  src="https://cdn.counter.dev/script.js"
  data-id="1ee3dbbd-09d2-42d4-b892-dfdb6f9b8e95"
  data-utcoffset="-5">
</script>

<script>
function isAndroid() {
    return /Android/i.test(navigator.userAgent);
}

// отправка pageview ОБЯЗАТЕЛЬНО
window.addEventListener('load', function () {
    if (window.counter) {
        counter.trackPageview();
    }
});

async function trackDownload(method) {
    // GA4
    if (typeof gtag !== 'undefined') {
        gtag('event', 'app_download', {
            event_category: 'Download',
            event_label: 'IL-HEAVY-GROUP-LLC.apk',
            method: method
        });
    }

    // counter.dev Event
    if (window.counter) {
        counter.track('apk_download');
    }

    // Cloudflare Counter API
    try {
        await fetch('/api/download-count', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        });
    } catch (error) {
        console.error('Error tracking download:', error);
        // Не блокируем скачивание при ошибке
    }
}

window.onload = function () {
    if (isAndroid()) {
        document.getElementById('android').style.display = 'block';

        const link = document.createElement('a');
        link.href = 'app/IL-HEAVY-GROUP-LLC.apk';   // путь к APK
        link.download = 'IL-HEAVY-GROUP-LLC.apk';

        link.addEventListener('click', function () {
            trackDownload('auto');
        });

        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

    } else {
        document.getElementById('not-android').style.display = 'block';
    }
};
</script>
</head>

<body style="font-family: Arial, sans-serif; text-align:center; padding:50px;">

<div id="android" style="display:none;">
    <h1>Downloading app…</h1>
    <p>
        If the download doesn’t start,
        <a href="app/IL-HEAVY-GROUP-LLC.apk"
           download
           onclick="trackDownload('manual');">
           click here
        </a>
    </p>
</div>

<div id="not-android" style="display:none;">
    <h1>Android only</h1>
    <p>This application is available <strong>only for Android devices</strong>.</p>
</div>

</body>
</html>